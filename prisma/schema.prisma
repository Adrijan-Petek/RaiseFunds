// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  fid       Int?     @unique
  username  String?
  pfpUrl    String?
  createdAt DateTime @default(now())

  fundraisers Fundraiser[]
  @@map("users")
}

model Fundraiser {
  id                  String     @id @default(cuid())
  creatorUserId       String
  creator             User       @relation(fields: [creatorUserId], references: [id])
  title               String
  description         String
  goalAmount          Decimal    @default(0)
  currency            String     @default("ETH")
  beneficiaryAddress  String
  coverImageUrl       String?
  category            String
  deadline            DateTime?
  status              Status     @default(ACTIVE)
  registryCampaignId  String?
  vaultAddress        String?
  totalRaisedCached   Decimal    @default(0)
  createdAt           DateTime   @default(now())
  updatedAt           DateTime   @updatedAt

  donations           Donation[]
  updates             Update[]
  reports             Report[]
  @@map("fundraisers")
}

model Donation {
  id            String       @id @default(cuid())
  fundraiserId  String
  fundraiser    Fundraiser   @relation(fields: [fundraiserId], references: [id])
  donorName     String?
  donorAddress  String?
  amount        Decimal
  message       String?
  paymentRef    String?
  status        DonationStatus @default(PENDING)
  createdAt     DateTime     @default(now())

  @@map("donations")
}

model Update {
  id           String     @id @default(cuid())
  fundraiserId String
  fundraiser   Fundraiser @relation(fields: [fundraiserId], references: [id])
  text         String
  imageUrl     String?
  createdAt    DateTime   @default(now())

  @@map("updates")
}

model Report {
  id           String     @id @default(cuid())
  fundraiserId String
  fundraiser   Fundraiser @relation(fields: [fundraiserId], references: [id])
  reason       String
  details      String?
  createdAt    DateTime   @default(now())

  @@map("reports")
}

enum Status {
  ACTIVE
  PAUSED
  ENDED
  HIDDEN
}

enum DonationStatus {
  PENDING
  CONFIRMED
  FAILED
}